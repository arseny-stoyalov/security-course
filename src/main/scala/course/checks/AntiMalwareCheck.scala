package course.checks

import cats.effect.Resource
import course.config.AntiMalwareCheckConfig
import monix.eval.Task

import scala.io.Source

class AntiMalwareCheck(config: AntiMalwareCheckConfig) extends Check {

  override def evaluate(): Task[String] =
    appExists
      .map {
        case true => "Антивирус DrWeb работает"
        case false => "Антивирус DrWeb не работает"
      }

  private def appExists =
    Resource
      .make(Task.eval(Source.fromInputStream(sys.runtime.exec(s"${config.processLsCommand}").getInputStream)))(s =>
        Task.eval(s.close())
      )
      .use { src =>
        Task.eval(src.mkString.contains(config.processName))
      }

}
