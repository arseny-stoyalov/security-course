package course.checks
import cats.effect.Resource
import course.config.AntiMalwareCheckConfig
import monix.eval.Task

import scala.io.Source

class HasAntiMalwareCheck(config: AntiMalwareCheckConfig) extends Check {

  override def evaluate(): Task[String] =
    appExists
      .map {
        case true => "Антивирус DrWeb установлен"
        case false => "Антивирус не установлен"
      }

  private def appExists =
    Resource
      .make(Task.eval(Source.fromInputStream(sys.runtime.exec(s"${config.lsAppsCommand}").getInputStream)))(s =>
        Task.eval(s.close())
      )
      .use { src =>
        Task.eval(src.mkString.contains(config.appName))
      }

}
